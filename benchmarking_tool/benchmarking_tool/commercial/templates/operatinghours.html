<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/operating-hours.css')}}" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/calendarize"></script>
<script src="https://unpkg.com/sublet"></script>
<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/styleguide.css')}}" />
<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/globals.css')}}" />


  <body style="margin: 0; background: #ffffff">
    <input type="hidden" id="anPageName" name="page" value="operating-hours" />
    <div class="container-center-horizontal">
      <div class="operating-hours screen">
        <div class="overlap-group31">
          <div class="rectangle-2893"></div>
          <div class="header"></div>
          <div class="welcome-john avertacy-bold-sapphire-20px">Welcome John,</div>
          <div class="kpis avertacy-bold-sapphire-13px">KPIâ€™S</div>
          <div class="historical avertacy-bold-sapphire-13px">Historical</div>
          <div class="inventory avertacy-bold-sapphire-13px">Inventory</div>
          <div class="utilities avertacy-bold-sapphire-13px">Utilities</div>
          <div class="operating-hours-1 avertacy-bold-sapphire-13px">Operating Hours</div>
          <div class="group-7235">
            <div class="ellipse-437"></div>
          </div>
          <img class="rectangle-2938" src="{{url_for('static',filename='img/rectangle-2938@22x.svg')}}" />
          <img class="kaltire-256-2" src="{{url_for('static',filename='img/kaltire--256-2@22x.png')}}" />
          <div class="store-087 avertacy-bold-sapphire-16px">Store #087</div>
          <p class="address avertacy-bold-sapphire-10px">4720 Yellowhead Trail NW,<br />Edmonton, AB T5L 3CS</p>
          <div class="group-7195"><img class="chevron-down" src="{{url_for('static',filename='img/vector@22x.svg')}}" /></div>
          <div class="your-viewing avertacy-bold-sapphire-16px">Your Viewing</div>
          <div class="live-usage avertacy-bold-sapphire-13px">Live Usage</div>
        </div>
        <div class="overlap-group32">
          <div class="flex-row">
            <h1 class="title avertacy-bold-sapphire-38px">Operating Hours</h1>
          </div>

<form onsubmit="setTimeout(function(){window.location.reload();},10);" method = "POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
<fieldset  onchange="submit();">
  <div class="input">
    <select id="month" name = 'month'>
      <optgroup class = 'month'>
      <option value="0" {% if month==0 %} selected="selected" {% endif %}>January 2021</option>
      <option value="1"{% if month==1 %} selected="selected" {% endif %}>February 2021</option>
      <option value="2"{% if month==2 %} selected="selected" {% endif %}>March 2021</option>
      <option value="3"{% if month==3 %} selected="selected" {% endif %}>April 2021</option>
      <option value="4"{% if month==4 %} selected="selected" {% endif %}>May 2021</option>
      <option value="5"{% if month==5 %} selected="selected" {% endif %}>June 2021</option>
      <option value="6"{% if month==6 %} selected="selected" {% endif %}>July 2021</option>
      <option value="7"{% if month==7 %} selected="selected" {% endif %}>August 2021</option>
      <option value="8"{% if month==8 %} selected="selected" {% endif %}>September 2021</option>
      <option value="9"{% if month==9 %} selected="selected" {% endif %}>October 2021</option>
      <option value="10"{% if month==10 %} selected="selected" {% endif %}>November 2021</option>
      <option value="11"{% if month==11 %} selected="selected" {% endif %}>December 2021</option>
      </optgroup>
    </select>

     <!-- <input id="year" type="number" min="1900" max="2100" step="1" value="2021"> -->
  </div>
 </fieldset>
</form>

<div id="calendar">
  <div class="labels"></div>
  <div class="dates"></div>
  <div class = 'operatinghours'></div>
  <div class = 'operatinghoursend'></div>
  <div class = 'divider'></div>
  <div class = 'startam'></div>
  <div class = 'endam'></div>
</div>
</div>

<script>const $ = document.querySelector.bind(document);
const h = tag => document.createElement(tag);

const text_labels = {
  en: ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'],
  es: ['DOM', 'LUN', 'MAR', 'MIE', 'JUV', 'VIE', 'SAB'],
};

// -- setup

const labels = $('#calendar .labels');
const dates = $('#calendar .dates');
const operatinghours = $('#calendar .operatinghours');
const operatinghoursend = $('#calendar .operatinghoursend');
const divider = $('#calendar .divider');
const startam = $('#calendar .startam');
const endam = $('#calendar .endam');
const month = {{month}};

const lspan = Array.from({ length: 7 }, () => {
  return labels.appendChild(h('span'));
});

const dspan = Array.from({ length: 42 }, () => {
  return dates.appendChild(h('span'));
});
const ospan = Array.from({ length: 42 }, () => {
  return operatinghours.appendChild(h('span'));
});
const ospanend = Array.from({ length: 42 }, () => {
  return operatinghoursend.appendChild(h('span'));
});
const divspan = Array.from({ length: 42 }, () => {
  return divider.appendChild(h('span'));
});
const startamspan = Array.from({ length: 42 }, () => {
  return startam.appendChild(h('span'));
});

const endamspan = Array.from({ length: 42 }, () => {
  return endam.appendChild(h('span'));
});


// -- state mgmt
  
const view = sublet({
  lang: 'en',
  offset: 0,
  year: 2021,
  month: month,
}, update);
  
function update(state) {
  const offset = state.offset;
  const starthours = {{starthours|tojson}};
  const endhours = {{endhours|tojson}};
  const startam = {{startam|tojson}};
  const endam = {{endam|tojson}};
  
  // apply day labels
  const txts = text_labels[state.lang];
  lspan.forEach((el, idx) => {
    el.textContent = txts[(idx + offset) % 7];
  });
  
  // apply date labels (very naiive way, pt 1)
  let i=0, j=0,k=0, date = new Date(state.year, state.month);
  calendarize(date, offset).forEach(week => {
    for (j=0; j < 7; j++) {
      ospan[i].textContent = week[j] > 0 ? starthours[i]: ' ';
      ospanend[i].textContent = week[j] > 0 ? endhours[i]: '';
      startamspan[i].textContent = week[j] > 0 && startam[i] != null ? ":00 " + startam[i]: '';
      endamspan[i].textContent = week[j] > 0 && endam[i] != null ? ":00 " + endam[i]: '';
      divspan[i].textContent = week[j] > 0 && startam[i] != null ? "|": '';
      dspan[i++].textContent = week[j] > 0 ? week[j]: '';
    
    }
  });
  
  // clear remaining (very naiive way, pt 2)
  while (i < dspan.length) dspan[i++].textContent = '';
}

// -- inputs



$('#month').onchange = ev => {
  view.month = ev.target.value;
};

// $('#year').onchange = ev => {
//   view.year = ev.target.value;
// };

</script>

<script>
  $("#next").click(function() {
  var nextElement = $('#month > option:selected').next('option');
  if (nextElement.length > 0) {
    $('#month > option:selected').removeAttr('selected').next('option').attr('selected', 'selected');
  }
});

$("#prev").click(function() {
  var nextElement = $('#month > option:selected').prev('option');
  if (nextElement.length > 0) {
    $('#month > option:selected').removeAttr('selected').prev('option').attr('selected', 'selected');
  }
});
</script>
