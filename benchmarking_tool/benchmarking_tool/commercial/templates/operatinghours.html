<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/operating-hours.css')}}" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/calendarize"></script>
<script src="https://unpkg.com/sublet"></script>
<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/styleguide.css')}}" />
<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/globals.css')}}" />


  <body style="margin: 0; background: #ffffff" onload="uncheck();">
    <input type="hidden" id="anPageName" name="page" value="operating-hours" />
    <div class="container-center-horizontal">
      <div class="operating-hours screen">
        <div class="rectangle-2893-l6cqYc"  id = 'leftretract'>
        <div class = 'activeline'></div>
        <img class = 'retractbuttonleft' id = 'leftbutton' onclick = "retractleft()" src = "{{url_for('static',filename='img/retractbuttonbackground.png')}}"/><img class = 'retractbuttonarrowleft'  onclick = "retractleft()" id = 'leftarrow' src = "{{url_for('static',filename='img/retractbuttonarrow.png')}}"/>
        <div class="header-l6cqYc" id = 'logodiv'><img class="pollen-2-7QcJ16" id = logoimage src="{{url_for('static',filename='img/logoimage.png')}}" /></div>
        <div class="dashboard-l6cqYc" id = 'dashboard'><img class="dashboardimage" src="{{url_for('static',filename='img/dashboardimage.png')}}" />Dashboard</div>
        <div class="overview-l6cqYc" id = 'liveusage'><img class="liveusageimage" src="{{url_for('static',filename='img/liveusageonimage.png')}}" />Data Stream</div>
        <div class="inventory-l6cqYc" id = 'inventory'><img class="inventoryimage" src="{{url_for('static',filename='img/inventoryimage.png')}}" />Inventory</div>
         <a href = "{{url_for('commercial.utilities')}}"><div class="utilities-l6cqYc" id = 'utilities'><img class="utilitiesimage" src="{{url_for('static',filename='img/utilitiesimage.png')}}" />Utilities & Alternatives</div></a>
        <a href = "{{url_for('accounts.logout')}}"><div class="logout-l6cqYc avertacy-bold-sapphire-13px" id = 'logout'><img class="logoutimage" src="{{url_for('static',filename='img/logoutimage.png')}}" />Logout</div></a>

        <div class = 'imageblock' id ='imageblock'>
        <img class="kaltire-256-2-l6cqYc" src="{{url_for('static',filename='img/kaltire--256-2@22x.png')}}" />
        <div class = 'buildingname'>Butetown Store</div>
        <p class="x4720-yellowhead-on-ab-t5-l-3-cs-l6cqYc">4720 Yellowhead Trail NW</p>
        <a href = "{{url_for('commercial.liveusage')}}"><div class = 'aboutbutton'><img class="info-imageblue" src="{{url_for('static',filename='img/infoimageblue.png')}}"/>About</div></a>
        <div class = 'switchbutton'><img class="info-imageblue" src="{{url_for('static',filename='img/switchimage.png')}}"/>Switch</div>
        <div class="group-7195-l6cqYc">
          <div class="rectangle-2316-33iHaU"></div>
          <div class="chevron-down-33iHaU"><img class="vector-LNtgXx" src="{{url_for('static',filename='img/vector@22x.svg')}}" /></div>
            </div>
        </div>
    </div>
        <div class="overlap-group32">
          <div class="flex-row">
            <h1 class="title avertacy-bold-sapphire-38px">Operating Hours</h1>
          </div>

<form method = "POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
<fieldset  onchange="submit();">
  <div class="input">
    <select id="month" name = 'month'>
      <optgroup class = 'month'>
      <option value="0" {% if month==0 %} selected="selected" {% endif %}>January 2021</option>
      <option value="1"{% if month==1 %} selected="selected" {% endif %}>February 2021</option>
      <option value="2"{% if month==2 %} selected="selected" {% endif %}>March 2021</option>
      <option value="3"{% if month==3 %} selected="selected" {% endif %}>April 2021</option>
      <option value="4"{% if month==4 %} selected="selected" {% endif %}>May 2021</option>
      <option value="5"{% if month==5 %} selected="selected" {% endif %}>June 2021</option>
      <option value="6"{% if month==6 %} selected="selected" {% endif %}>July 2021</option>
      <option value="7"{% if month==7 %} selected="selected" {% endif %}>August 2021</option>
      <option value="8"{% if month==8 %} selected="selected" {% endif %}>September 2021</option>
      <option value="9"{% if month==9 %} selected="selected" {% endif %}>October 2021</option>
      <option value="10"{% if month==10 %} selected="selected" {% endif %}>November 2021</option>
      <option value="11"{% if month==11 %} selected="selected" {% endif %}>December 2021</option>
      </optgroup>
    </select>

     <!-- <input id="year" type="number" min="1900" max="2100" step="1" value="2021"> -->
  </div>
 </fieldset>
 <div id = 'editor' class = 'editor'>
  <p class = 'edittitle' id = 'edittitle'></p>

  <p class = 'starttitle'>Opening Hour</p>
   <input id = 'newstart' class = 'newstart' name = 'newstart' type = "number" min = '0' max = '23' step = '1' value = 8>
   <input name = startmins type = number pattern="[0-9]*" min = 00 max = '59' step = 01 value = 30  class = 'newstartclock'>

   <p class = 'endtitle'>Closing Hour</p>
   <input id = 'newend' class = 'newend' name = 'newend' type = "number" min = '0' max = '23' step = '1' value = 17>
   <input name = 'endmins' type = number pattern="[0-9]*" min = 00 max = '59' step = 01 value = 30 class = 'newendclock'>

   <input type="checkbox" id = 'changed' name = changed value="true" style="opacity: 0.0;">
   <input type="text" id = 'datenumber' name = datenumber style="opacity: 0.0;  display: none;">

   <div class = 'bulk'>
   <select id="bulk" name = 'bulk'>
      <optgroup>
      <option value="single" selected="selected">Update Just Today</option>
      <option value="weekday" id = 'weekday'></option>
      <option value="everyday">Change for Everyday of the Month</option>
      <option value="everyweekday">Change for Every Weekday of the Month</option>
      </optgroup>
    </select></div>
   <button type = 'submit' class = "editbutton" onclick = 'check();'>Submit</button>
   <div class="closebutton" onclick = "hideedit();"><img src="{{url_for('static',filename='img/vector-2@222x.svg')}}" /></div>
 </div>
</form>

<div id="calendar">
  <div class="labels"></div>
  <div class="dates"></div>
  <div class = 'operatinghours'></div>
  <div class = 'operatinghoursend'></div>
  <div class = 'divider'></div>
  <div class = 'startam'></div>
  <div class = 'endam'></div>
  <div class = 'editimage'></div>
</div>

</div>

<script>

const $ = document.querySelector.bind(document);
const h = tag => document.createElement(tag);

const text_labels = {
  en: ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'],
  es: ['DOM', 'LUN', 'MAR', 'MIE', 'JUV', 'VIE', 'SAB'],
};

// -- setup

const labels = $('#calendar .labels');
const dates = $('#calendar .dates');
const operatinghours = $('#calendar .operatinghours');
const operatinghoursend = $('#calendar .operatinghoursend');
const divider = $('#calendar .divider');
const startam = $('#calendar .startam');
const endam = $('#calendar .endam');
const editimage = $('#calendar .editimage');
const month = {{month}};

const lspan = Array.from({ length: 7 }, () => {
  return labels.appendChild(h('span'));
});

const dspan = Array.from({ length: 42 }, () => {
  return dates.appendChild(h('span'));
});
const ospan = Array.from({ length: 42 }, () => {
  return operatinghours.appendChild(h('span'));
});
const ospanend = Array.from({ length: 42 }, () => {
  return operatinghoursend.appendChild(h('span'));
});
const divspan = Array.from({ length: 42 }, () => {
  return divider.appendChild(h('span'));
});
const startamspan = Array.from({ length: 42 }, () => {
  return startam.appendChild(h('span'));
});

const endamspan = Array.from({ length: 42 }, () => {
  return endam.appendChild(h('span'));
});

const editspan = Array.from({ length: 42 }, () => {
  return editimage.appendChild(h('span'));
});

// -- state mgmt
  
const view = sublet({
  lang: 'en',
  offset: 0,
  year: 2021,
  month: month,
}, update);
  
function update(state) {
  const offset = state.offset;
  const starthours = {{starthours|tojson}};
  const endhours = {{endhours|tojson}};
  const startam = {{startam|tojson}};
  const endam = {{endam|tojson}};
  const startminutes = {{startminutes|tojson}};
  const endminutes = {{endminutes|tojson}};
  
  // apply day labels
  const txts = text_labels[state.lang];
  lspan.forEach((el, idx) => {
    el.textContent = txts[(idx + offset) % 7];
  });
  
  // apply date labels (very naiive way, pt 1)
  let i=0, j=0,k=0, date = new Date(state.year, state.month);
  calendarize(date, offset).forEach(week => {
    for (j=0; j < 7; j++) {
      ospan[i].textContent = week[j] > 0 ? starthours[i]: ' ';
      ospanend[i].textContent = week[j] > 0 ? endhours[i]: '';
      startamspan[i].textContent = week[j] > 0 && startam[i] != null ? ":" + startminutes[i] + ' ' + startam[i]: '';
      endamspan[i].textContent = week[j] > 0 && endam[i] != null ? ":" + endminutes[i] + ' ' + endam[i]: '';
      divspan[i].textContent = week[j] > 0 && startam[i] != null ? "|": '';
      editspan[i].textContent = week[j] > 0 ? '': '1';
      dspan[i++].textContent = week[j] > 0 ? week[j]: '';

    
    }
  });
  
  // clear remaining (very naiive way, pt 2)
  while (i < dspan.length) dspan[i++].textContent = '';
}

// -- inputs



$('#month').onchange = ev => {
  view.month = ev.target.value;
};


// $('#year').onchange = ev => {
//   view.year = ev.target.value;
// };

  function sceSelect() {
    console.log(this.textContent || this.innerText);
    showedit(this.textContent);
}
var spans = document.getElementsByTagName('span');
for (var i = 0, len = spans.length; i < len; i++) {
    spans[i].onclick = sceSelect;
}
console.log(spans.length)

</script>
<script>
  function check() {
    document.getElementById("changed").checked = true;
}

function uncheck() {
    document.getElementById("changed").checked = false;
}

function hideedit(){
 document.getElementById("editor").style.boxShadow  = "0 0 0 0px rgba(0,0,0,.50)";
 document.getElementById("editor").style.display = 'none';
}
function showedit(date){
  const d = new Date(2021, month, date);
  const weekday = new Array(7);
  weekday[0] = "Sunday";
  weekday[1] = "Monday";
  weekday[2] = "Tuesday";
  weekday[3] = "Wednesday";
  weekday[4] = "Thursday";
  weekday[5] = "Friday";
  weekday[6] = "Saturday";
  document.getElementById("editor").style.display = "block";
  document.getElementById("editor").style.boxShadow  = "-10px 10px 8px #888888";
  document.getElementById("edittitle").innerHTML = 'Editing Operating Hours For The ' + date;
  document.getElementById("weekday").innerHTML = 'Update for every ' + weekday[d.getDay()] + ' in the month';
  document.getElementById("datenumber").value = date;
}

</script>

